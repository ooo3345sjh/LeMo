<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    날짜 : 2023/03/08
    이름 : 이원정
    내용 : 관리자 mapper
 -->
<mapper namespace="kr.co.Lemo.dao.AdminDAO">

    <!-- select -->

    <!-- admin - user - list (user+business+admin) -->
    <select id="selectUser" parameterType="kr.co.Lemo.utils.SearchCondition" resultType="kr.co.Lemo.domain.UserVO">
        select * from `lemo_member_userinfo`
        where 1=1
        <include refid="searchCondition"/>
        <include refid="searchIsEnabled"/>
        <include refid="searchLevel"/>
        <include refid="searchType"/>
        order by `rdate` desc limit #{offset}, 10;
    </select>

    <!-- admin - user - count total users for pagination -->
    <select id="countUser" parameterType="kr.co.Lemo.utils.SearchCondition" resultType="java.lang.Integer">
        select count(*) from `lemo_member_userinfo`
        where 1=1
        <include refid="searchCondition"/>
        <include refid="searchIsEnabled"/>
        <include refid="searchLevel"/>
        <include refid="searchType"/>
    </select>

    <!-- insert -->

    <!-- update -->
    <update id="updateMemo">
        update `lemo_member_userinfo` set `memo`=#{memo} where `user_id`=#{user_id};
    </update>

    <update id="updateIsLocked">
        update `lemo_member_userinfo` set `isLocked`=0 where `user_id`=#{user_id};
    </update>

    <update id="updateIsEnabled">
        update `lemo_member_userinfo` set `isEnabled`=0, `wdate`=NOW() where `user_id`=#{user_id};
    </update>

    <!-- delete -->

    <!-- 공통 키 -->

    <!-- include :: sql 구문 재사용 -->
    <!-- admin - user - search condition::list -->
    <sql id="searchCondition">
        <if test="searchField != null">
            <choose>
                <when test='searchField == "userId"'>
                   and `user_id` like CONCAT('%', #{searchWord}, '%')
                </when>
                <when test='searchField == "userNick"'>
                   and `nick` like CONCAT('%', #{searchWord}, '%')
                </when>
            </choose>
        </if>
    </sql>

    <sql id="searchIsEnabled">
        <if test="searchIsEnabled != null">
            <choose>
                <when test="searchIsEnabled == 1">
                    and `isEnabled`=1
                </when>
                <when test="searchIsEnabled == 0">
                    and `isEnabled`=0
                </when>
            </choose>
        </if>
    </sql>

    <sql id="searchLevel">
        <if test="searchLevel != null">
            <choose>
                <when test="searchLevel == 1">
                    and `level`=1
                </when>
                <when test="searchLevel == 2">
                    and `level`=2
                </when>
            </choose>
        </if>
    </sql>

    <sql id="searchType">
        <if test="searchType != null">
            <choose>
                <when test="searchType == 1">
                    and `type`=1
                </when>
                <when test="searchType == 2">
                    and `type`=2
                </when>
            </choose>
        </if>
    </sql>

</mapper>