<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    날짜 : 2023/03/09
    이름 : 박종협
    내용 : my mapper
 -->
<mapper namespace="kr.co.Lemo.dao.MyDAO">

    <!-- select -->
    <select id="selectPoints" resultType="kr.co.Lemo.domain.PointVO">
        SELECT * FROM `lemo_member_point_log` WHERE `user_id`= #{user_id} ORDER BY `poi_rdate` DESC;
    </select>

    <select id="selectReservations" resultType="kr.co.Lemo.domain.ReservationVO">
        SELECT
            b.*, a.`acc_name`, a.`province_no`, a.`acc_thumbs`, c.`room_checkIn`, c.`room_checkOut`, b.`res_checkIn`, b.`res_checkOut`
        FROM
            `lemo_product_accommodation` AS a LEFT JOIN
            `lemo_product_reservation`   AS b ON a.`acc_id` = b.`acc_id` LEFT JOIN
            `lemo_product_room`          AS c ON b.`room_id` = c.`room_id`
        WHERE b.`user_id` = #{user_id}
        <if test="myCate == 'review'">
            AND b.`res_state` = 2
        </if>
    </select>

    <select id="selectMemberCoupons" resultType="kr.co.Lemo.domain.CouponVO">
        SELECT
            a.`cp_id`, a.`cp_subject`, a.`cp_rate`, a.`cp_price`, a.`cp_start`, a.`cp_end`, a.`cp_minimum`, a.`cp_disType`, b.`user_id`, b.`mcp_isUsed`
        FROM
            `lemo_product_coupon` AS a LEFT JOIN
            `lemo_member_coupon` AS b ON a.`cp_id` = b.`cp_id`
        WHERE a.`cp_end` > DATE(NOW()) AND b.`user_id`=#{user_id};
    </select>

    <select id="selectProductCoupons" resultType="kr.co.Lemo.domain.CouponVO">
        SELECT * FROM `lemo_product_coupon`
        WHERE `cp_id` NOT IN( SELECT `cp_id` FROM `lemo_member_coupon` WHERE `user_id` = #{user_id} );
    </select>

    <select id="selectPicks" resultType="kr.co.Lemo.domain.ProductAccommodationVO">
        SELECT
            b.`acc_id`, b.`acc_name`, b.`province_no`, b.`acc_addr`, b.`acc_addrDetail`, b.`acc_rate`, b.`acc_thumbs`, b.`acc_review`
        FROM
            `lemo_product_pick` AS a LEFT JOIN
            `lemo_product_accommodation` AS b ON a.`acc_id` = b.`acc_id`
        WHERE a.`user_id` = #{user_id};
    </select>

    <select id="selectReviews" resultType="kr.co.Lemo.domain.ReviewVO">
        SELECT
            a.`province_no`, a.`acc_name`, a.`acc_id`, a.`acc_thumbs`, b.`res_checkIn`, b.`res_checkOut`
        FROM
            `lemo_product_accommodation` AS a LEFT JOIN
            `lemo_product_reservation` AS b ON a.`acc_id` = b.`acc_id` LEFT JOIN
            `lemo_product_review` AS c ON b.`res_no` = c.`res_no`
        WHERE c.`user_id` = #{user_id};
    </select>

    <select id="selectDiaryArticle" resultType="kr.co.Lemo.domain.ArticleDiaryVO">
        SELECT * FROM `lemo_diary_article` WHERE `user_id`=#{user_id};
    </select>

    <select id="selectDiarySpot" resultType="kr.co.Lemo.domain.DiarySpotVO">
        SELECT * FROM `lemo_diary_spot` WHERE `arti_no`=#{arti_no};
    </select>

    <select id="selectDiary" resultType="kr.co.Lemo.domain.DiarySpotVO">
        SELECT
            a.`arti_title`, b.*
        FROM
            `lemo_diary_article` AS a JOIN
            `lemo_diary_spot` AS b ON a.`arti_no` = b.`arti_no`
        WHERE `user_id`=#{user_id};
    </select>

    <select id="selectProvinceAddr" resultType="kr.co.Lemo.domain.ProductAccommodationVO">
        SELECT
            c.`province_name`, b.`acc_addr`
        FROM
            `lemo_product_reservation` AS a LEFT JOIN
            `lemo_product_accommodation`  AS b ON a.`acc_id` = b.`acc_id` LEFT JOIN
            `lemo_product_province` AS c ON b.`province_no` = c.`province_no`
        WHERE a.`res_no` = #{res_no};
    </select>

    <!-- insert -->
    <insert id="insertDiaryArticle" parameterType="kr.co.Lemo.domain.ArticleDiaryVO" useGeneratedKeys="true" keyProperty="arti_no">
        INSERT INTO `lemo_diary_article` SET
            `res_no`     = #{res_no},
            `user_id`    = #{user_id},
            `arti_title` = #{arti_title},
            `arti_thumb` = #{arti_thumb},
            `arti_rdate` = NOW(),
            `arti_regip` = #{arti_regip},
            `arti_start` = #{arti_start},
            `arti_end`   = #{arti_end}
    </insert>

    <insert id="insertDiarySpot" parameterType="kr.co.Lemo.domain.DiarySpotVO">
        INSERT INTO `lemo_diary_spot` SET
            `arti_no`         = #{arti_no},
            `spot_longtitude` = #{spot_longtitude},
            `spot_lattitude`  = #{spot_lattitude},
            `spot_xy`         = ST_GeomFromText(CONCAT('POINT(', #{spot_longtitude}, ' ', #{spot_lattitude}, ')')),
            `spot_title`      = #{spot_title},
            `spot_content`    = #{spot_content},
            `spot_thumb`      = #{spot_thumb},
            `province_name`   = #{province_name},
            `spot_addr`       = #{spot_addr}
    </insert>

    <insert id="insertCoupon" parameterType="kr.co.Lemo.domain.CouponVO">
        INSERT INTO `lemo_member_coupon` SET
            `cp_id`     = #{cp_id},
            `user_id`   = #{user_id},
            `mcp_rdate` = NOW()
    </insert>

    <!-- update -->


    <!-- delete -->

    <!-- MyVO안에 VO값들 -->
    <!-- 공통으로 하려고 했으나 폐기 추후 삭제 -->
    <!--
    <select id="selectMyArticle" resultMap="MyVO">
        <choose>
            <when test="myCate == 'coupon'">
                SELECT * FROM
                    `lemo_member_coupon` AS a JOIN
                    `lemo_product_coupon` AS b ON a.`cp_id` = b.`cp_id`
                WHERE a.`user_id` = #{user_id};
            </when>
            <when test="myCate == 'info'">

            </when>
            <when test="myCate == 'pick'">
                SELECT * FROM
                    `lemo_product_pick` AS a JOIN
                    `lemo_product_accommodation` AS b ON a.`acc_id` = b.`acc_id`
                WHERE a.`user_id` = #{user_id};
            </when>
            <when test="myCate == 'point'">
                SELECT * FROM `lemo_product_pick` WHERE `user_id`=#{user_id}
            </when>
            <when test="myCate == 'reservation'">

            </when>
            <when test="myCate == 'view'">

            </when>
            <when test="myCate == 'review'">

            </when>
        </choose>
    </select>

    <resultMap id="MyVO" type="kr.co.Lemo.domain.MyVO">
        <collection property="pointVO" resultMap="pointVO"></collection>
        <collection property="couponVO" resultMap="couponVO"></collection>
        <collection property="reservationVO" resultMap="reservationVO"></collection>
        <collection property="pickVO" resultMap="pickVO"></collection>
        <collection property="reviewVO" resultMap="reviewVO"></collection>
    </resultMap>

    <resultMap id="pointVO" type="kr.co.Lemo.domain.PointVO">
        <id property="poi_id" column="poi_id"/>
        <id property="user_id" column="user_id"/>
        <id property="res_no" column="res_no"/>
        <id property="poi_content" column="poi_content"/>
        <id property="poi_point" column="poi_point"/>
        <id property="poi_maximum" column="poi_maximum"/>
        <id property="poi_state" column="poi_state"/>
        <id property="poi_rdate" column="poi_rdate"/>
    </resultMap>

    <resultMap id="couponVO" type="kr.co.Lemo.domain.CouponVO">
        <id property="mcp_id" column="mcp_id"/>
        <id property="mcp_isUsed" column="mcp_isUsed"/>
        <id property="mcp_start" column="mcp_start"/>
        <id property="mcp_end" column="mcp_end"/>
        <id property="mcp_rdate" column="mcp_rdate"/>
    </resultMap>

    <resultMap id="reservationVO" type="kr.co.Lemo.domain.ReservationVO">
        <id property="res_no" column="res_no"/>
        <id property="acc_id" column="acc_id"/>
        <id property="room_id" column="room_id"/>
        <id property="user_id" column="user_id"/>
        <id property="res_price" column="res_price"/>
        <id property="res_disPrice" column="res_disPrice"/>
        <id property="res_name" column="res_name"/>
        <id property="res_hp" column="res_hp"/>
        <id property="res_payment" column="res_payment"/>
        <id property="res_date" column="res_date"/>
        <id property="res_checkIn" column="res_checkIn"/>
        <id property="res_checkOut" column="res_checkOut"/>
        <id property="res_state" column="res_state"/>
        <id property="res_memo" column="res_memo"/>
    </resultMap>

    <resultMap id="pickVO" type="kr.co.Lemo.domain.PickVO">
        <id property="acc_id" column="acc_id"/>
        <id property="user_id" column="user_id"/>
    </resultMap>

    <resultMap id="reviewVO" type="kr.co.Lemo.domain.ReviewVO">
        <id property="revi_id" column="revi_id"/>
        <id property="res_no" column="res_no"/>
        <id property="revi_rate" column="revi_rate"/>
        <id property="revi_title" column="revi_title"/>
        <id property="revi_content" column="revi_content"/>
        <id property="revi_reply" column="revi_reply"/>
        <id property="revi_regip" column="revi_regip"/>
        <id property="revi_rdate" column="revi_rdate"/>
        <id property="revi_thumb" column="revi_thumb"/>
    </resultMap>
    -->

    <!-- 공통 키 -->

</mapper>