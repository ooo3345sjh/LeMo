<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin-layout}">
<th:block layout:fragment="css-js">
    <link rel="stylesheet" th:href="@{/css/admin/adminFaq.css}">
    <link rel="stylesheet" th:href="@{/css/admin/adminCommon.css}">
</th:block>
<th:block layout:fragment="content">
    <main>
        <div class="main_inner">
                <!-- 죄측 사이드바 -->
            <th:block th:replace="~{fragments/_aside::adminFragment}"></th:block>
                <!-- 우측 메인 컨테이너 -->
                <section class="main_content">
                    <div class="main_cotent_inner">
                        <div class="main_content_div">
                            <!-- 판매자인 경우 출력-->
                            <div class="col0" style="margin-bottom: 20px;">
                                <form action="#">
                                    <div class="selectProdForAdmin">
                                        <select name="cs_type" onchange="if(this.value) location.href=(this.value);">
                                            <option th:value="@{/admin/cs/faq/list}">유형선택</option>
                                            <option th:value="@{/admin/cs/faq/list (cs_type= 'event')}" th:selected="${ph.sc.cs_type == 'event'}">이벤트</option>
                                            <option th:value="@{/admin/cs/faq/list (cs_type= 'payment')}" th:selected="${ph.sc.cs_type == 'payment'}">예약/결제</option>
                                            <option th:value="@{/admin/cs/faq/list (cs_type= 'cancel')}" th:selected="${ph.sc.cs_type == 'cancel'}">취소/환불</option>
                                            <option th:value="@{/admin/cs/faq/list (cs_type= 'benefit')}" th:selected="${ph.sc.cs_type == 'benefit'}">혜택받기</option>
                                            <option th:value="@{/admin/cs/faq/list (cs_type= 'use')}" th:selected="${ph.sc.cs_type == 'use'}">이용문의</option>
                                            <option th:value="@{/admin/cs/faq/list (cs_type= 'info')}" th:selected="${ph.sc.cs_type == 'info'}">회원정보</option>
                                            <option th:value="@{/admin/cs/faq/list (cs_type= 'review')}" th:selected="${ph.sc.cs_type == 'review'}">리뷰</option>
                                            <option th:value="@{/admin/cs/faq/list (cs_type= 'refund')}" th:selected="${ph.sc.cs_type == 'refund'}">환불신청</option>
                                            <option th:value="@{/admin/cs/faq/list (cs_type= 'point')}" th:selected="${ph.sc.cs_type == 'point'}">쿠폰/포인트</option>
                                        </select>
                                    </div>
                                </form>
                            </div>

                            <div class="col_nav">
                                <span>고객센터 ></span>
                                <span>자주묻는질문</span>
                            </div>
                            <div class="col2">
                                <form action="#">
                                    <div class="faq_list">
                                        <ul>
                                            <th:block th:each="faq:${csArticles}">
                                            <!-- li 반복 -->
                                                <li class="faq_tit">
                                                    <input type="hidden" name="cs_no" th:data-no="${faq.cs_no}">
                                                    <a href="#" id="faq_tab" class="faq_list_a">
                                                        <p>[[${faq.cs_type_ko}]]&nbsp;&nbsp;&nbsp;&nbsp; [[${faq.cs_title}]]</p>
                                                    </a>
                                                    <span>
                                                        <a class="btnFaqModify" th:href="@{/admin/cs/faq/modify (cs_no=${faq.cs_no})}">수정</a>
                                                        <a class="btnFaqDelete">삭제</a>
                                                    </span>

                                                    <div class="faq_content">
                                                        <p>
                                                            [[${faq.cs_content}]]
                                                        </p>

                                                    </div>
                                                </li>
                                            </th:block>
                                        </ul>


                                    </div>
                                    <div class="pagination" th:object="${ph}" th:style="${#lists.size(csArticles) == 0 ? 'visibility:hidden;':''}">

                                        <th:block th:if="*{showPrev}">
                                            <a th:href="@{/admin/cs/faq/list} + ${ph.sc.cs_type + ph.sc.getQueryString(ph.beginPage-1)}" class="prev">< </a>
                                        </th:block>


                                        <th:block th:each="num:${#numbers.sequence(ph.beginPage, ph.endPage)}">
                                                <a th:href="@{/admin/cs/faq/list} + ${ph.sc.getQueryString(num)}" th:class="${num == ph.sc.page ? 'num current':'num'}">
                                                    [[${num}]]
                                                </a>
                                        </th:block>


                                        <th:block th:if="*{showNext}">
                                            <a th:href="@{/admin/cs/faq/list} + ${ph.sc.cs_type + ph.sc.getQueryString(ph.endPage+1)}" class="next"> ></a>
                                        </th:block>

                                    </div>
                                    <div class="btnAdminProd4">
                                        <a th:href="@{/admin/cs/faq/write}">
                                            작성
                                        </a>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="blank30"></div>
                    </div>
                </section>
            </div>
        </main>
    <th:block th:replace="~{fragments/_footer::footerFragment}"></th:block>
</th:block>
<th:block layout:fragment="script">
<script>
    $(document).ready(function() {
        $('.faq_list_a').click(function(e){
            e.preventDefault();
            // $(this).find('div').slideToggle();
            // $(this).find('.faq_list_a').toggleClass('open');
            $(this).next().next().slideToggle();
            $(this).toggleClass('open');
        });


        // faq 삭제
        $('.btnFaqDelete').click(function(e){
            e.preventDefault();

            let isDeleteOK = confirm('해당 글을 삭제하시겠습니까?');

            if(isDeleteOK){
                let cs_no = $(this).parent().parent().children('input').attr('data-no');

                console.log('cs_no ajax : ' + cs_no);

                const jsonData = {"cs_no": cs_no};

                ajaxAPI("admin/cs/faq/removeFaqWrite", jsonData, "post").then((response) => {
                    if(response.result > 0) {
                        alert("해당 글이 삭제되었습니다.");
                        location.replace("/Lemo/admin/cs/faq/list");
                    }else {
                        alert('error');
                    }
                }).catch((errMsg) => {
                    console.log(errorMsg);
                });
            }

        });


    });
</script>

</th:block>
</html>